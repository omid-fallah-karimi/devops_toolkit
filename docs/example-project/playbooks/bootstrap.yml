---
# Bootstrap playbook - Initial server setup
# Usage: ansible-playbook -i inventory/production/hosts playbooks/bootstrap.yml

- name: Bootstrap Linux Servers
  hosts: all
  become: true
  gather_facts: true

  pre_tasks:
    - name: Display server information
      ansible.builtin.debug:
        msg: |
          Bootstrapping: {{ inventory_hostname }}
          OS: {{ ansible_distribution }} {{ ansible_distribution_version }}
          Target timezone: {{ timezone }}

  roles:
    # Set system timezone
    - role: omid_fallah_karimi.devops_toolkit.set_timezone
      vars:
        timezone: "{{ timezone }}"

    # Install base packages
    - role: omid_fallah_karimi.devops_toolkit.install_packages
      vars:
        packages: "{{ base_packages }}"
        package_state: present

    # Install Docker (optional - set install_docker: true in group_vars)
    - role: omid_fallah_karimi.devops_toolkit.install_docker
      vars:
        docker_users: "{{ docker_users | default([]) }}"
        docker_install_compose: "{{ docker_install_compose | default(false) }}"
      when: install_docker | default(false) | bool

  post_tasks:
    - name: Display completion message
      ansible.builtin.debug:
        msg: "âœ“ Bootstrap completed for {{ inventory_hostname }}"
